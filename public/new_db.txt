-- 1. Roles (Acting as the Primary Identity/Account Table)
CREATE TABLE roles (
    id SERIAL PRIMARY KEY, -- This is the UID you're referring to
    role_name VARCHAR(50) NOT NULL,
    email VARCHAR(255) UNIQUE -- Typically accounts have an email/login
);

-- 2. Departments Table
CREATE TABLE departments (
    department_id SERIAL PRIMARY KEY,
    name VARCHAR(100) NOT NULL,
    description TEXT
);

-- 3. Users Table (Profile Table)
-- Here, the user_id IS the foreign key pointing to roles(id)
CREATE TABLE users (
    user_id uuid PRIMARY KEY REFERENCES profiles(id) ON DELETE CASCADE,
    up_id VARCHAR(20) UNIQUE NOT NULL,
    first_name VARCHAR(100) NOT NULL,
    last_name VARCHAR(100) NOT NULL,
    department_id INTEGER REFERENCES departments(department_id),
    position_id INTEGER,
    entry_date DATE DEFAULT CURRENT_DATE
);

-- 4. Awards Table
CREATE TABLE awards (
    award_id SERIAL PRIMARY KEY,
    title VARCHAR(200) NOT NULL,
    description TEXT
);

-- 5. Publications Table
CREATE TABLE publications (
    publication_id SERIAL PRIMARY KEY,
    type VARCHAR(50),
    title VARCHAR(255) NOT NULL,
    publisher VARCHAR(255),
    publication_status VARCHAR(50),
    date_published DATE,
    page_number VARCHAR(50),
    issue_number VARCHAR(50),
    page_numbers VARCHAR(50),
    journal_publication VARCHAR(50),
    volume_number VARCHAR(50)
);

-- 6. Publication Authors (Many-to-Many)
CREATE TABLE publication_authors (
    publication_id integer REFERENCES publications(publication_id) ON DELETE CASCADE,
    user_id uuid REFERENCES users(user_id) ON DELETE CASCADE,
    author_rank INTEGER,
    PRIMARY KEY (publication_id, user_id)
);

-- 7. Submissions Table
CREATE TABLE submissions (
    submission_id SERIAL PRIMARY KEY,
    submitter_id uuid NOT NULL REFERENCES users(user_id),
    award_id INTEGER REFERENCES awards(award_id),
    publication_id INTEGER REFERENCES publications(publication_id),
    reviewed_by_admin_id uuid REFERENCES users(user_id),
    date_submitted TIMESTAMPTZ DEFAULT CURRENT_TIMESTAMP,
    status VARCHAR(20) DEFAULT 'pending',
    attached_files BYTEA,
    remarks TEXT,
    pdf_json_data JSONB NOT NULL DEFAULT '{}',
    logs JSONB DEFAULT '[]'
);


-- 8. Publication-Award Application Tracker
CREATE TABLE publication_award_applications (
    id SERIAL PRIMARY KEY,
    publication_id INTEGER NOT NULL REFERENCES publications(publication_id) ON DELETE CASCADE,
    award_id INTEGER NOT NULL REFERENCES awards(award_id) ON DELETE CASCADE,
    submission_id INTEGER REFERENCES submissions(submission_id), -- Links to the actual process
    application_date DATE DEFAULT CURRENT_DATE,
    
    -- This constraint prevents the SAME publication 
    -- from being applied for the SAME award twice.
    UNIQUE(publication_id, award_id)
);
